package tiger

import (
	"encoding/json"
	"log"
	"testing"

	"github.com/stretchr/testify/require"
)

func TestNewFareCacheFromBytes(t *testing.T) {
	data := []byte(`{"departureStation":"TPE","arrivalStation":"HND","fares":[{"fareAmount":5099.0000,"taxesAndFeesAmount":500.000,"totalAmount":5599.0000,"available":10,"departureDate":"2020-01-01","day":1,"ratio":"43.9607%"},{"fareAmount":8099.0000,"taxesAndFeesAmount":500.000,"totalAmount":8599.0000,"available":6,"departureDate":"2020-01-02","day":2,"ratio":"69.8250%"},{"fareAmount":9099.0000,"taxesAndFeesAmount":500.000,"totalAmount":9599.0000,"available":2,"departureDate":"2020-01-03","day":3,"ratio":"78.4464%"},{"fareAmount":null,"taxesAndFeesAmount":null,"totalAmount":null,"available":null,"departureDate":"2020-01-04","day":4,"ratio":"%"},{"fareAmount":null,"taxesAndFeesAmount":null,"totalAmount":null,"available":null,"departureDate":"2020-01-05","day":5,"ratio":"%"},{"fareAmount":8099.0000,"taxesAndFeesAmount":500.000,"totalAmount":8599.0000,"available":1,"departureDate":"2020-01-06","day":6,"ratio":"69.8250%"},{"fareAmount":4699.0000,"taxesAndFeesAmount":500.000,"totalAmount":5199.0000,"available":7,"departureDate":"2020-01-07","day":7,"ratio":"40.5121%"},{"fareAmount":3699.0000,"taxesAndFeesAmount":500.000,"totalAmount":4199.0000,"available":12,"departureDate":"2020-01-08","day":8,"ratio":"31.8907%"},{"fareAmount":3399.0000,"taxesAndFeesAmount":500.000,"totalAmount":3899.0000,"available":10,"departureDate":"2020-01-09","day":9,"ratio":"29.3043%"},{"fareAmount":3699.0000,"taxesAndFeesAmount":500.000,"totalAmount":4199.0000,"available":9,"departureDate":"2020-01-10","day":10,"ratio":"31.8907%"},{"fareAmount":null,"taxesAndFeesAmount":null,"totalAmount":null,"available":null,"departureDate":"2020-01-11","day":11,"ratio":"%"},{"fareAmount":null,"taxesAndFeesAmount":null,"totalAmount":null,"available":null,"departureDate":"2020-01-12","day":12,"ratio":"%"},{"fareAmount":null,"taxesAndFeesAmount":null,"totalAmount":null,"available":null,"departureDate":"2020-01-13","day":13,"ratio":"%"},{"fareAmount":null,"taxesAndFeesAmount":null,"totalAmount":null,"available":null,"departureDate":"2020-01-14","day":14,"ratio":"%"},{"fareAmount":null,"taxesAndFeesAmount":null,"totalAmount":null,"available":null,"departureDate":"2020-01-15","day":15,"ratio":"%"},{"fareAmount":null,"taxesAndFeesAmount":null,"totalAmount":null,"available":null,"departureDate":"2020-01-16","day":16,"ratio":"%"},{"fareAmount":null,"taxesAndFeesAmount":null,"totalAmount":null,"available":null,"departureDate":"2020-01-17","day":17,"ratio":"%"},{"fareAmount":11599.0000,"taxesAndFeesAmount":500.000,"totalAmount":12099.0000,"available":9,"departureDate":"2020-01-18","day":18,"ratio":"100.0000%"},{"fareAmount":null,"taxesAndFeesAmount":null,"totalAmount":null,"available":null,"departureDate":"2020-01-19","day":19,"ratio":"%"},{"fareAmount":null,"taxesAndFeesAmount":null,"totalAmount":null,"available":null,"departureDate":"2020-01-20","day":20,"ratio":"%"},{"fareAmount":8099.0000,"taxesAndFeesAmount":500.000,"totalAmount":8599.0000,"available":5,"departureDate":"2020-01-21","day":21,"ratio":"69.8250%"},{"fareAmount":8099.0000,"taxesAndFeesAmount":500.000,"totalAmount":8599.0000,"available":6,"departureDate":"2020-01-22","day":22,"ratio":"69.8250%"},{"fareAmount":11599.0000,"taxesAndFeesAmount":500.000,"totalAmount":12099.0000,"available":31,"departureDate":"2020-01-23","day":23,"ratio":"100.0000%"},{"fareAmount":11599.0000,"taxesAndFeesAmount":500.000,"totalAmount":12099.0000,"available":49,"departureDate":"2020-01-24","day":24,"ratio":"100.0000%"},{"fareAmount":9099.0000,"taxesAndFeesAmount":500.000,"totalAmount":9599.0000,"available":6,"departureDate":"2020-01-25","day":25,"ratio":"78.4464%"},{"fareAmount":8099.0000,"taxesAndFeesAmount":500.000,"totalAmount":8599.0000,"available":4,"departureDate":"2020-01-26","day":26,"ratio":"69.8250%"},{"fareAmount":8099.0000,"taxesAndFeesAmount":500.000,"totalAmount":8599.0000,"available":22,"departureDate":"2020-01-27","day":27,"ratio":"69.8250%"},{"fareAmount":8099.0000,"taxesAndFeesAmount":500.000,"totalAmount":8599.0000,"available":12,"departureDate":"2020-01-28","day":28,"ratio":"69.8250%"},{"fareAmount":6099.0000,"taxesAndFeesAmount":500.000,"totalAmount":6599.0000,"available":22,"departureDate":"2020-01-29","day":29,"ratio":"52.5821%"},{"fareAmount":4699.0000,"taxesAndFeesAmount":500.000,"totalAmount":5199.0000,"available":15,"departureDate":"2020-01-30","day":30,"ratio":"40.5121%"},{"fareAmount":4399.0000,"taxesAndFeesAmount":500.000,"totalAmount":4899.0000,"available":19,"departureDate":"2020-01-31","day":31,"ratio":"37.9257%"}],"flightDates":["2020-01-01","2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31"],"currency":{"active":true,"displayPrefix":"TWD","displaySuffix":null,"displayDigits":2,"roundingFactor":1.000,"code":"TWD","name":"Taiwan Dollar"},"updatedDate":"2019-12-28T06:15:59.5150688Z"}`)
	got, err := NewFareCacheFromBytes(data)
	require.NoError(t, err)
	require.Len(t, got.Fares, 31)

	b, err := json.MarshalIndent(got, "", "    ")
	require.NoError(t, err)
	log.Print(string(b))
}
